<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pencatatan Hutang Pelanggan</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #ff004c;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        form {
            margin-bottom: 20px;
        }
        input, button {
            padding: 10px;
            margin: 5px;
            width: 100%;
            box-sizing: border-box;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .debt-list {
            margin-top: 20px;
        }
        .debt-item {
            background-color: #daccb9ce;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .debt-item button {
            background-color: #ff004c;
            color: white;
            border: none;
            cursor: pointer;
            padding: 8px 15px;
            margin-left: 10px;
        }
        .debt-item button:hover {
            background-color: #cf1a4e;
        }
        .debt-item p {
            margin: 0;
            flex: 1;
            text-align: left;
        }
        .payment-form {
            display: flex;
            margin-top: 10px;
            justify-content: space-between;
            width: 100%;
        }
        .payment-form input {
            width: 70%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .payment-form button {
            width: 28%;
            padding: 10px;
            background-color: #4caf50;
            color: white;
            border: none;
            cursor: pointer;
        }
        .payment-form button:hover {
            background-color: #45a049;
        }
        .debt-amount {
            font-weight: bold;
            color: #ff004c;
        }
        .payment-history {
            margin-top: 10px;
            padding: 5px;
            background-color: #f0f0f0;
            border-radius: 4px;
            width: 100%;
        }
        .payment-history span {
            display: block;
        }
        .debt-lunas {
            color: green;
            font-weight: bold;
        }
        .delete-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .payment-history div {
            margin-bottom: 10px;
        }
        .payment-history hr {
            border: 1px solid #ccc;
            margin: 10px 0;
        }
        .tagih-button {
            background-color: #4caf50 !important;
            color: white;
            padding: 8px 15px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            text-align: center;
        }
        .tagih-button:hover {
            background-color: #128c7e !important;
        }
        .total-debt {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }
        .delete-all-payments-button {
            background-color: #ff9800;
            color: white;
            padding: 8px 15px;
            border: none;
            cursor: pointer;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .delete-all-payments-button:hover {
            background-color: #fb8c00;
        }

        /* Gaya untuk tombol Hapus Data ketika hutang lunas */
        .delete-lunas-button {
            background-color: black;  /* Anda bisa mengubah ini dengan warna yang Anda inginkan */
            color: white;
            padding: 8px 15px;
            border: none;
            cursor: pointer;
            margin-top: 10px;
            border-radius: 4px;
            text-align: center;
        }

        /* Efek hover untuk tombol Hapus Data ketika hutang lunas */
        .delete-lunas-button:hover {
            background-color: #333;  /* Ubah warna ini untuk efek hover */
        }

    </style>
</head>
<body>

    <div class="container">
        <h1>Sistem Pencatatan Hutang Pelanggan</h1>
    
        <form id="searchForm">
            <input type="text" id="searchInput" placeholder="Cari Nama Pelanggan" oninput="searchDebts()">
        </form>
    
        <div class="total-debt">
            <p>Total Hutang: Rp <span id="totalDebtAmount">0</span></p>
            <p>Total Pembayaran: Rp <span id="totalPaymentsAmount">0</span></p>
        </div>
    
        <button class="delete-all-payments-button" onclick="deleteAllPayments()">Hapus Semua Riwayat Pembayaran</button>
    
        <form id="debtForm">
            <input type="text" id="customerName" placeholder="Nama Pelanggan" required>
            <input type="text" id="customerPhone" placeholder="Nomor HP (Mulai dengan 62)" required>
            <input type="number" id="debtAmount" placeholder="Jumlah Hutang" required>
            <button type="submit">Tambah Hutang</button>
        </form>
    
        <div class="debt-list" id="debtList">
            <h2>Daftar Hutang</h2>
            <!-- Daftar hutang akan muncul di sini -->
        </div>
    </div>
    
    <script>
        // Ambil data hutang yang disimpan di localStorage
        let debts = JSON.parse(localStorage.getItem('debts')) || [];
        let searchQuery = '';
    
        // Fungsi untuk menampilkan daftar hutang
        function displayDebts() {
            const debtList = document.getElementById('debtList');
            debtList.innerHTML = '<h2>Daftar Hutang</h2>'; // Reset konten
    
            let totalDebt = 0;
            let totalPayments = 0;
    
            // Filter hutang berdasarkan nama yang dicari
            const filteredDebts = debts.filter(debt =>
                debt.customerName.toLowerCase().includes(searchQuery.toLowerCase())
            );
    
            if (filteredDebts.length === 0) {
                debtList.innerHTML += '<p>Tidak ada hutang yang sesuai dengan pencarian.</p>';
                document.getElementById('totalDebtAmount').innerText = totalDebt.toLocaleString();
                document.getElementById('totalPaymentsAmount').innerText = totalPayments.toLocaleString();
                return;
            }
    
            filteredDebts.forEach((debt, index) => {
                const debtItem = document.createElement('div');
                debtItem.classList.add('debt-item');
                debtItem.innerHTML = `
                    <p>${debt.customerName} - ${debt.customerPhone} - <span class="debt-amount">Rp ${debt.amount.toLocaleString()}</span>
                    ${debt.amount <= 0 ? '<span class="debt-lunas">Hutang Lunas</span>' : ''}</p>
                    ${debt.amount > 0 ? `
                        <button class="pay-button" onclick="togglePaymentForm(${index})">Bayar</button>
                        <div id="paymentForm${index}" class="payment-form" style="display: none;">
                            <input type="number" id="paymentAmount${index}" placeholder="Jumlah Pembayaran" />
                            <button class="confirm-payment" onclick="confirmPayment(${index})">Konfirmasi Pembayaran</button>
                        </div>
                    ` : ''}
                    <button onclick="addDebtAmount(${index})">Tambah Hutang</button>
                    <div class="payment-history">
                        <h4>Riwayat Pembayaran</h4>
                        ${debt.payments.map(payment => {
                            return `
                                <span>
                                    Tanggal: ${payment.date} | 
                                    Pembayaran: Rp ${payment.paid.toLocaleString()} | 
                                    Setelah: Rp ${payment.after.toLocaleString()}
                                </span>
                                <hr />
                            `;
                        }).join('')}
                    </div>
                    ${debt.amount <= 0 ? `<button class="delete-lunas-button" onclick="removeCustomerData(${index})">Hapus Data</button>` : ''}
                    <button class="tagih-button" onclick="tagihCustomer(${index})">Tagih via WhatsApp</button>
                `;
    
                debtList.appendChild(debtItem);
    
                totalDebt += debt.amount;
                totalPayments += debt.payments.reduce((sum, payment) => sum + payment.paid, 0);
            });
    
            // Update total debt and payment values
            document.getElementById('totalDebtAmount').innerText = totalDebt.toLocaleString();
            document.getElementById('totalPaymentsAmount').innerText = totalPayments.toLocaleString();
        }
    
        // Fungsi untuk toggle form pembayaran
        function togglePaymentForm(index) {
            const paymentForm = document.getElementById(`paymentForm${index}`);
            if (paymentForm.style.display === "none" || paymentForm.style.display === "") {
                paymentForm.style.display = "block";
            } else {
                paymentForm.style.display = "none";
            }
        }
    
        // Fungsi untuk konfirmasi pembayaran
        function confirmPayment(index) {
            const paymentAmount = parseFloat(document.getElementById(`paymentAmount${index}`).value);
    
            if (paymentAmount > 0 && debts[index].amount > 0) {
                const debt = debts[index];
                const newAmount = debt.amount - paymentAmount;
                debt.amount = newAmount < 0 ? 0 : newAmount;
    
                debt.payments.push({
                    date: new Date().toLocaleString(),
                    paid: paymentAmount,
                    after: debt.amount
                });
    
                localStorage.setItem('debts', JSON.stringify(debts));
                displayDebts();
            }
        }
    
        // Fungsi untuk menambahkan hutang baru
        function addDebtAmount(index) {
            const additionalDebt = parseFloat(prompt('Masukkan jumlah tambahan hutang:'));
    
            if (additionalDebt > 0) {
                debts[index].amount += additionalDebt;
    
                localStorage.setItem('debts', JSON.stringify(debts));
                displayDebts();
            }
        }
    
        // Fungsi untuk menghapus data pelanggan jika hutang lunas
        function removeCustomerData(index) {
            debts.splice(index, 1);
            localStorage.setItem('debts', JSON.stringify(debts));
            displayDebts();
        }
    
        // Fungsi untuk mencari hutang
        function searchDebts() {
            searchQuery = document.getElementById('searchInput').value;
            displayDebts();
        }
    
        // Fungsi untuk menghapus semua riwayat pembayaran
function deleteAllPayments() {
    debts.forEach(debt => {
        // Hapus hanya riwayat pembayaran tanpa mengubah jumlah hutang
        debt.payments = [];
    });

    // Simpan perubahan ke localStorage
    localStorage.setItem('debts', JSON.stringify(debts));
    // Tampilkan kembali daftar hutang setelah perubahan
    displayDebts();
}
    
        // Fungsi untuk tagih lewat WhatsApp
        function tagihCustomer(index) {
            const debt = debts[index];
            const message = `Halo ${debts[index].customerName},\n\n
Hutang kamu di kami masih Rp ${debts[index].amount.toLocaleString()}. Bisa dibayarkan besok, ya? 😉\n\n
Kami tunggu pembayarannya! Terima kasih.`;
            const whatsappUrl = `https://wa.me/${debt.customerPhone}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }
    
        // Menambahkan hutang baru ke dalam array debts dan menyimpannya
        document.getElementById('debtForm').addEventListener('submit', function(e) {
            e.preventDefault();
    
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const debtAmount = parseFloat(document.getElementById('debtAmount').value);
    
            if (customerName && customerPhone && !isNaN(debtAmount)) {
                const newDebt = {
                    customerName: customerName,
                    customerPhone: customerPhone,
                    amount: debtAmount,
                    originalAmount: debtAmount, // Menyimpan jumlah hutang asli
                    payments: []
                };
    
                debts.push(newDebt);
                localStorage.setItem('debts', JSON.stringify(debts));
                displayDebts();
    
                // Reset form
                document.getElementById('debtForm').reset();
            }
        });
    
        // Menampilkan daftar hutang awal
        displayDebts();
    </script>
    
    </body>
    </html>
