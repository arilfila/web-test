<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pencatatan Hutang Pelanggan</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #c00000;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        form {
            margin-bottom: 20px;
        }
        input, button {
            padding: 10px;
            margin: 5px;
            width: 100%;
            box-sizing: border-box;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .debt-list {
            margin-top: 20px;
        }
        .debt-item {
            background-color: #daccb9ce;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .delete-lunas-button {
    background-color: #000000; /* Warna hijau untuk tombol bayar */
    color: white; /* Teks berwarna putih */
    padding: 10px 5px; /* Padding dalam tombol */
    border: none; /* Menghapus border default */
    border-radius: 5px; /* Sudut tombol yang melengkung */
    font-size: 16px; /* Ukuran font */
    cursor: pointer; /* Menunjukkan bahwa tombol dapat diklik */
    margin-top: 10px; /* Jarak atas tombol */
}

.delete-lunas-button:hover {
    background-color: #635f60; /* Warna lebih gelap saat hover */
}
        
        /* Gaya untuk tombol Pay */
.pay-button {
    background-color: #ec3654; /* Warna hijau untuk tombol bayar */
    color: white; /* Teks berwarna putih */
    padding: 10px 5px; /* Padding dalam tombol */
    border: none; /* Menghapus border default */
    border-radius: 5px; /* Sudut tombol yang melengkung */
    font-size: 16px; /* Ukuran font */
    cursor: pointer; /* Menunjukkan bahwa tombol dapat diklik */
    margin-top: 10px; /* Jarak atas tombol */
}

.pay-button:hover {
    background-color: #8d002a; /* Warna lebih gelap saat hover */
}

/* Gaya untuk tombol Add Debt */
.add-debt-button {
    background-color: #ec3654; /* Warna biru untuk tombol tambah hutang */
    color: white; /* Teks berwarna putih */
    padding: 10px 20px; /* Padding dalam tombol */
    border: none; /* Menghapus border default */
    border-radius: 5px; /* Sudut tombol yang melengkung */
    font-size: 16px; /* Ukuran font */
    cursor: pointer; /* Menunjukkan bahwa tombol dapat diklik */
    margin-top: 10px; /* Jarak atas tombol */
}

.add-debt-button:hover {
    background-color: #8d002a; /* Warna lebih gelap saat hover */
}

        .debt-item p {
            margin: 0;
            flex: 1;
            text-align: left;
        }
        .payment-form {
            display: flex;
            margin-top: 10px;
            justify-content: space-between;
            width: 100%;
        }
        .payment-form input {
            width: 70%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .payment-form button {
            width: auto;
            padding: auto;
            background-color: #4caf50;
            color: white;
            border: none;
            cursor: pointer;
        }
        .payment-form button:hover {
            background-color: #45a049;
        }
        .debt-amount {
    font-weight: bold;
    color: #fffb00;
    font-size: 18px;
    text-shadow: 1px 1px 2px black, -1px -1px 2px black; /* Garis tepi dengan bayangan */
}
        .payment-history {
            margin-top: 10px;
            padding: 5px;
            background-color: #f0f0f0;
            border-radius: 4px;
            width: 100%;
        }
        .payment-history span {
            display: block;
        }

        /* Tombol Hapus untuk setiap riwayat pembayaran */
.delete-payment {
    background-color: transparent; /* Background transparan */
    border: 1px solid #ccc; /* Border abu-abu tipis */
    color: #999; /* Warna teks abu-abu */
    font-size: 12px; /* Ukuran font kecil */
    padding: 5px 10px; /* Padding kecil */
    cursor: pointer; /* Menampilkan kursor pointer */
    border-radius: 5px; /* Sudut tombol melengkung */
    transition: all 0.3s ease; /* Transisi animasi */
}

/* Efek hover untuk tombol Hapus */
.delete-payment:hover {
    background-color: #f44336; /* Warna latar belakang merah saat hover */
    color: white; /* Ubah warna teks menjadi putih */
    border-color: #f44336; /* Ubah border menjadi merah */
}

/* Tombol Hapus saat ditekan */
.delete-payment:active {
    transform: scale(0.95); /* Menurunkan ukuran tombol sedikit saat ditekan */
}

/* Tombol Hapus disabled (jika diinginkan) */
.delete-payment:disabled {
    background-color: #f0f0f0; /* Latar belakang tombol disabled */
    border-color: #ddd; /* Border tombol disabled */
    color: #bbb; /* Warna teks tombol disabled */
    cursor: not-allowed; /* Menunjukkan tombol tidak bisa ditekan */
}

        .debt-lunas {
            color: green;
            font-weight: bold;
        }
        .payment-history div {
            margin-bottom: 10px;
        }
        .payment-history hr {
            border: 1px solid #ccc;
            margin: 10px 0;
        }
        .tagih-button {
            background-color: #4caf50 !important;
            color: white;
            padding: 8px 15px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            text-align: center;
        }
        .tagih-button:hover {
            background-color: #128c7e !important;
        }
        .total-debt {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }
        .delete-all-payments-button {
            background-color: #fbff00;
            color: rgb(0, 0, 0);
            padding: 8px 15px;
            border: none;
            cursor: pointer;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .delete-all-payments-button:hover {
            background-color: #a3fb00;
        }

.debt-item {
    background-color: #e2e4ffce;
    padding: 15px;
    margin: 15px 0;
    border-radius: 4px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    position: relative; /* Menjaga tombol tetap di dalam konteks item */
}

/* Gaya untuk tombol Edit */
.edit-button {
    background-color: #d9ff00; /* Warna tombol */
    color: rgb(0, 0, 0);
    padding: 5px 10px;
    border: none;
    cursor: pointer;
    border-radius: 4px;
    font-size: 14px;
    margin-left:5px; /* Jarak dari nama pelanggan */
}

.edit-button:hover {
    background-color: #a3fb00; /* Efek hover */
}

/* Styling untuk tombol backup */
.backup-button {
            background-color: #21bbeb;
            color: white;
            padding: 8px 15px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            margin-top: 10px;
        }
        .backup-button:hover {
            background-color: #11038a;
        }

        /* Styling untuk textarea backup */
        #backupTextarea {
            white-space: pre-wrap;
            font-family: monospace;
            overflow-x: auto;
            height: auto;
        }
        /* Tombol Kembalian */
        .return-button {
    background-color: #f10404; /* Warna hijau untuk tombol bayar */
    color: white; /* Teks berwarna putih */
    padding: 10px 5px; /* Padding dalam tombol */
    border: none; /* Menghapus border default */
    border-radius: 5px; /* Sudut tombol yang melengkung */
    font-size: 16px; /* Ukuran font */
    cursor: pointer; /* Menunjukkan bahwa tombol dapat diklik */
    margin-top: 10px; /* Jarak atas tombol */
}

.return-button:hover {
    background-color: #8d002a; /* Warna lebih gelap saat hover */
}
/* Formulir Kembalian */
.return-form {
    margin-top: px;
    background-color: #f9f9f9; /* Warna latar belakang form kembalian */
    padding: 5px;
    border-radius: 15px;
    border: 1px solid #ddd; /* Garis border ringan */
    display: none; /* Awalnya disembunyikan */
}

/* Input untuk nominal kembalian */
.return-form input {
    width: 98%;
    padding: 10px;
    font-size: 16px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-sizing: border-box; /* Agar padding tidak mempengaruhi lebar input */
}

/* Tombol Hitung Kembalian */
.confirm-return {
    background-color: #28a745; /* Warna hijau untuk tombol konfirmasi */
    color: white;
    width: 98%;
    padding: 8px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    display: inline-block;
}

.confirm-return:hover {
    background-color: #218838; /* Warna hijau lebih gelap saat hover */
}

.return-amount-display {
    margin-top: 10px;
    font-weight: bold;
    color: #ff0000;
    font-size: 18px;
    text-align: center;
    display: block;
    width: 100%;
    font-family: 'Edu+AU+VIC+WA+NT+Hand', sans-serif; /* Menggunakan Poppins */
}

/* Jika kembalian sudah dihitung */
.return-form p {
    font-size: 16px;
    font-weight: bold;
    color: #28a745; /* Menunjukkan kembalian dengan warna hijau */
    margin-top: 10px;
}
.clickable-text {
    color: blue;
    text-decoration: underline;
    cursor: pointer;
}
/* Mengatur ukuran font untuk teks riwayat pembayaran */
.payment-record p {
    font-size: 12px; /* Ukuran font lebih kecil */
    color: #555; /* Warna teks abu-abu gelap untuk kontras yang lebih baik */
    margin: 5px 0; /* Memberikan jarak antar elemen <p> agar lebih rapih */
}

/* Mengatur teks jumlah pembayaran agar lebih mencolok (optional) */
.payment-record p:first-child {
    font-weight: bold; /* Menebalkan teks untuk "Jumlah Pembayaran" */
    color: #333; /* Warna teks lebih gelap untuk menarik perhatian */
}
/* Gaya untuk form secara keseluruhan */
#debtForm {
        width: 90%; /* Gunakan 90% dari lebar layar */
        max-width: 400px; /* Maksimal lebar form adalah 400px */
        margin: 20px auto;
        padding: 20px;
        background-color: #f4f4f4;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        box-sizing: border-box; /* Memastikan padding dihitung dalam lebar total */
    }

    /* Gaya untuk input text dan number */
    #debtForm input {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 16px;
    }
    #debtForm button {
    background-color: #6cf000; /* Warna latar belakang hijau */
    color: rgb(255, 255, 255); /* Warna teks putih */
    border: none; /* Menghilangkan border default */
    padding: auto; /* Padding untuk memberikan ruang di dalam tombol */
    text-align: center; /* Menyelaraskan teks ke tengah */
    text-decoration: none; /* Menghilangkan dekorasi teks */
    display: inline-block; /* Membuat tombol tampil dalam baris */
    font-size: 16px; /* Ukuran font */
    margin: 2px 5px; /* Margin antara tombol */
    border-radius: 8px; /* Membulatkan sudut tombol */
    cursor: pointer; /* Mengubah kursor menjadi pointer saat hover */
    transition: all 0.3s ease; /* Efek transisi saat interaksi */
}

#debtForm button:hover {
    background-color: #7bbd00; /* Warna latar belakang sedikit lebih gelap saat hover */
    transform: translateY(-2px); /* Efek angkat sedikit saat hover */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Menambahkan bayangan untuk efek 3D */
}

#debtForm button:active {
    background-color: #388e3c; /* Warna latar belakang lebih gelap saat tombol diklik */
    transform: translateY(0); /* Menghilangkan efek angkat saat tombol diklik */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Bayangan lebih ringan saat klik */
}

    /* Media Query untuk perangkat yang lebih kecil, seperti smartphone */
    @media (max-width: 600px) {
        #debtForm {
            width: 95%; /* Gunakan 95% dari lebar layar pada perangkat kecil */
        }

        #debtForm input,
        #debtForm button {
            font-size: 14px; /* Mengurangi ukuran font pada layar kecil untuk kenyamanan */
        }
    }
    .button-cari {
    background-color: #4CAF50; /* Warna latar belakang hijau */
    color: white; /* Warna teks putih */
    border: none; /* Menghilangkan border default */
    padding: auto; /* Padding untuk memberikan ruang di dalam tombol */
    text-align: center; /* Menyelaraskan teks ke tengah */
    text-decoration: none; /* Menghilangkan dekorasi teks */
    display: inline-block; /* Membuat tombol tampil dalam baris */
    font-size: 16px; /* Ukuran font */
    margin: 2px 5px; /* Margin antara tombol */
    border-radius: 8px; /* Membulatkan sudut tombol */
    cursor: pointer; /* Mengubah kursor menjadi pointer saat hover */
    transition: all 0.3s ease; /* Efek transisi saat interaksi */
}

.button-cari:hover {
    background-color: #45a049; /* Warna latar belakang sedikit lebih gelap saat hover */
    transform: translateY(-2px); /* Efek angkat sedikit saat hover */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Menambahkan bayangan untuk efek 3D */
}

.button-cari:active {
    background-color: #388e3c; /* Warna latar belakang lebih gelap saat tombol diklik */
    transform: translateY(0); /* Menghilangkan efek angkat saat tombol diklik */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Bayangan lebih ringan saat klik */
}
    </style>
</head>
<body>

    <div class="container">
        <h1>SERAH CELL</h1>

            <form id="searchForm">
                <input type="text" id="searchInput" placeholder="Cari Nama Pelanggan" oninput="searchDebts()">
            </form>

        <div class="total-debt">
            <p>Total Hutang: Rp <span id="totalDebtAmount">0</span></p>
            <p>Pembayaran: Rp <span id="totalPaymentsAmount" class="clickable-text">0</span></p>
        </div>  

            <!-- Tempat untuk menampilkan pelanggan dengan pembayaran lebih dari 0 -->
        <div id="paymentCustomersList" style="display: none;">
            <h3>Pelanggan dengan Pembayaran</h3>
            <ul id="paymentCustomers"></ul> <!-- Daftar pelanggan dengan pembayaran lebih dari 0 -->
        </div> 

        <div class="total-debt">
            <p>
                Kembalian: Rp <span id="totalReturnAmount" class="clickable-text">0</span>
            </p>
        </div>
        
        <!-- Tempat untuk menampilkan pelanggan dengan kembalian lebih dari 0 -->
        <div id="returnCustomersList" style="display: none;">
            <h3>Pelanggan dengan Kembalian</h3>
            <ul id="returnCustomers"></ul> <!-- Daftar pelanggan dengan kembalian lebih dari 0 -->
        </div>
        
        
        <button class="delete-all-payments-button" onclick="deleteAllPayments()">Hapus Semua Riwayat Pembayaran</button>
        <button class="backup-button" onclick="backupData()">Backup Data Hutang</button>
        <!-- Tambahkan tombol untuk menyalin di bawah textarea -->
<button id="copyBackupButton" class="backup-button" style="display: none;" onclick="copyBackupData()">Salin Data</button>
<pre id="backupTextarea" style="margin-top: 5px; padding: 10px; background-color: #f9f9f9; border: 1px solid #ccc; display: none;"></pre>

        <form id="debtForm">
            <input type="text" id="customerName" placeholder="Nama Pelanggan" required>
            <input type="text" id="customerPhone" placeholder="Nomor HP (Mulai dengan 62)" required oninput="sanitizePhoneInput(event)">
            <input type="number" id="debtAmount" placeholder="Jumlah Hutang" required>
            <button type="submit">Tambah Hutang</button>
        </form>
    
        <div class="debt-list" id="debtList">
            <h2>Daftar Hutang</h2>
            <!-- Daftar hutang akan muncul di sini -->
        </div>

    </div>
    
    <script>
        // Ambil data hutang yang disimpan di localStorage
        let debts = JSON.parse(localStorage.getItem('debts')) || [];
        let searchQuery = ''; // Variabel pencarian global
        
        // Fungsi untuk menampilkan daftar hutang
// Fungsi untuk menampilkan daftar hutang
function displayDebts() {
    const debtList = document.getElementById('debtList');
    debtList.innerHTML = '<h2>Daftar Hutang</h2>'; // Reset konten

    let totalDebt = 0;
    let totalPayments = 0;
    let totalReturn = 0;  // Variabel untuk menghitung total kembalian

    debts.forEach((debt, index) => {
        const debtItem = document.createElement('div');
        debtItem.classList.add('debt-item');
        debtItem.dataset.index = index; // Menambahkan index unik
        debtItem.id = `debt-item-${index}`;  // Menambahkan ID unik untuk setiap item
        debtItem.innerHTML = `
            <div style="display: flex; align-items: center;">
                <p>
                    <strong> ${index + 1}</strong><br> <!-- Menambahkan Index -->
                    ${debt.customerName} <br> ${debt.customerPhone} <br> 
                    <span class="debt-amount">Rp ${debt.amount.toLocaleString()}</span>
                    ${debt.amount <= 0 ? '<br><span class="debt-lunas">Hutang Lunas</span>' : ''}
                </p>
                <button class="edit-button" onclick="editCustomerData(${index})">Edit</button> <!-- Tombol Edit -->
            </div>
            ${debt.amount > 0 ? ` 
                <button class="pay-button" onclick="togglePaymentForm(${index})">Bayar</button>
                <div id="paymentForm${index}" class="payment-form" style="display: none;">
                    <input type="number" id="paymentAmount${index}" placeholder="Jumlah Pembayaran" />
                    <button class="confirm-payment" onclick="confirmPayment(${index})">Konfirmasi Pembayaran</button>
                </div>
            ` : ''}
<!-- Tombol untuk menambah hutang dan form input tambahan hutang -->
<button class="add-debt-button" onclick="toggleDebtForm(${index})">Tambah Hutang</button>
<div id="debtForm${index}" class="payment-form" style="display: none;">
    <input type="number" id="additionalDebtAmount${index}" placeholder="Jumlah Hutang Tambahan" />
    <button class="confirm-payment" onclick="confirmDebtAddition(${index})">Konfirmasi Tambah Hutang</button>
</div>


            <div class="payment-history">
                <h4>Riwayat Pembayaran</h4>
                ${debt.payments.map((payment, paymentIndex) => {
                    return `
                        <div class="payment-record">
                            <p>Jumlah Pembayaran: Rp ${payment.paid.toLocaleString()}</p>
                            <p>Tanggal: ${payment.date}</p>
                            <p>Setelah Pembayaran: Rp ${payment.after.toLocaleString()}</p>
                            <button class="delete-payment" onclick="deletePayment(${index}, ${paymentIndex})">Hapus</button>
                        </div>
                        <hr />
                    `;
                }).join('')}
            </div>
            ${debt.amount <= 0 ? `<button class="delete-lunas-button" onclick="removeCustomerData(${index})">Hapus Data</button>` : ''}
            ${debt.amount > 0 ? `<button class="tagih-button" onclick="tagihCustomer(${index})">Tagih via WhatsApp</button>` : ''}
        
            <!-- Tombol Kembalian -->
            <button class="return-button" onclick="showReturnForm(${index})">Kembalian</button>
            ${debt.returnAmount !== undefined ? `<p class="return-amount-display">Kembalian: Rp ${debt.returnAmount.toLocaleString()}</p>` : ''}
            <div id="returnForm${index}" class="return-form" style="display: none;">
                <input type="number" id="returnAmount${index}" placeholder="Masukkan Pembayaran" />
                <button class="confirm-return" onclick="processReturn(${index})">Hitung Kembalian</button>
            </div>
        `;

        debtList.appendChild(debtItem);

        // Menambahkan jumlah hutang, pembayaran, dan kembalian
        totalDebt += debt.amount;
        totalPayments += debt.payments.reduce((sum, payment) => sum + payment.paid, 0);
        totalReturn += debt.returnAmount || 0;  // Menambahkan kembalian jika ada
    });

    // Update total debt, total payments, dan total return values
    document.getElementById('totalDebtAmount').innerText = totalDebt.toLocaleString();
    document.getElementById('totalPaymentsAmount').innerText = totalPayments.toLocaleString();
    document.getElementById('totalReturnAmount').innerText = totalReturn.toLocaleString(); // Update total kembalian
}

// Fungsi untuk menghapus data customer berdasarkan index
function removeCustomerData(index) {
    // Ambil data customer dari localStorage
    let debts = JSON.parse(localStorage.getItem('debts')) || [];

    // Periksa apakah data yang ada pada index yang dimaksud ada
    if (index >= 0 && index < debts.length) {
        // Hapus data dari array debts
        debts.splice(index, 1);

        // Simpan kembali data yang telah diperbarui ke localStorage
        localStorage.setItem('debts', JSON.stringify(debts));

        // Ambil semua elemen debt-item berdasarkan kelas
        const debtItems = document.getElementsByClassName('debt-item');

        // Hapus elemen debt-item yang sesuai dengan index
        if (debtItems[index]) {
            debtItems[index].remove();
        }

        // Menampilkan pesan konfirmasi
        alert("Data customer berhasil dihapus!");
    } else {
        alert("Data tidak ditemukan!");
    }
}

// Fungsi untuk menampilkan pelanggan dengan pembayaran lebih dari 0
function viewPaymentCustomers() {
    const paymentCustomersList = document.getElementById('paymentCustomersList');
    
    // Cek apakah daftar pelanggan dengan pembayaran sudah ditampilkan
    if (paymentCustomersList.style.display === 'block') {
        // Jika sudah ditampilkan, sembunyikan daftar
        paymentCustomersList.style.display = 'none';
    } else {
        // Jika belum ditampilkan, tampilkan daftar dan perbarui kontennya
        const paymentCustomers = document.getElementById('paymentCustomers');
        
        // Reset daftar pelanggan
        paymentCustomers.innerHTML = '';

        // Filter data hutang untuk mendapatkan pelanggan yang memiliki pembayaran lebih dari 0
        const customersWithPayment = debts.filter(debt => debt.payments.reduce((sum, payment) => sum + payment.paid, 0) > 0);
        
        // Jika ada pelanggan dengan pembayaran, tampilkan nama dan total pembayaran mereka
        if (customersWithPayment.length > 0) {
            customersWithPayment.forEach(debt => {
                const totalPaid = debt.payments.reduce((sum, payment) => sum + payment.paid, 0);
                const listItem = document.createElement('li');
                listItem.textContent = `${debt.customerName} - Pembayaran: Rp ${totalPaid.toLocaleString()}`; // Menampilkan nama dan total pembayaran
                paymentCustomers.appendChild(listItem);
            });
            // Tampilkan daftar pelanggan
            paymentCustomersList.style.display = 'block';
        } else {
            // Jika tidak ada pelanggan dengan pembayaran, tampilkan pesan
            paymentCustomers.innerHTML = '<li>Tidak ada pelanggan dengan pembayaran.</li>';
            paymentCustomersList.style.display = 'block';
        }
    }
}

// Menambahkan event listener untuk elemen totalPaymentsAmount agar dapat diklik
document.getElementById('totalPaymentsAmount').addEventListener('click', function() {
    viewPaymentCustomers(); // Memanggil fungsi toggle ketika diklik
});

// Fungsi untuk menampilkan pelanggan dengan kembalian lebih dari 0
function viewReturnCustomers() {
    const returnCustomersList = document.getElementById('returnCustomersList');
    
    // Cek apakah daftar pelanggan dengan kembalian sudah ditampilkan
    if (returnCustomersList.style.display === 'block') {
        // Jika sudah ditampilkan, sembunyikan daftar
        returnCustomersList.style.display = 'none';
    } else {
        // Jika belum ditampilkan, tampilkan daftar dan perbarui kontennya
        const returnCustomers = document.getElementById('returnCustomers');
        
        // Reset daftar pelanggan
        returnCustomers.innerHTML = '';

        // Filter data hutang untuk mendapatkan pelanggan yang memiliki kembalian lebih dari 0
        const customersWithReturn = debts.filter(debt => debt.returnAmount > 0);
        
        // Jika ada pelanggan dengan kembalian, tampilkan nama dan kembalian mereka
        if (customersWithReturn.length > 0) {
            customersWithReturn.forEach(debt => {
                const listItem = document.createElement('li');
                listItem.textContent = `${debt.customerName} - Kembalian: Rp ${debt.returnAmount.toLocaleString()}`; // Menampilkan nama dan kembalian
                returnCustomers.appendChild(listItem);
            });
            // Tampilkan daftar pelanggan
            returnCustomersList.style.display = 'block';
        } else {
            // Jika tidak ada pelanggan dengan kembalian, tampilkan pesan
            returnCustomers.innerHTML = '<li>Tidak ada pelanggan dengan kembalian.</li>';
            returnCustomersList.style.display = 'block';
        }
    }
}
// Fungsi untuk form kembalian
function processReturn(index) {
    // Simpan posisi scroll sebelumnya
    const lastScrollPosition = window.scrollY;

    const returnAmountInput = parseInt(document.getElementById(`returnAmount${index}`).value);

    if (isNaN(returnAmountInput)) {
        alert("Masukkan jumlah kembalian yang valid!");
        return;
    }

    const debt = debts[index];

    // Jika nilai kembalian belum ada, inisialisasi
    if (debt.returnAmount === undefined) {
        debt.returnAmount = 0;
    }

    // Update nilai kembalian
    debt.returnAmount += returnAmountInput;

    // Simpan data hutang yang sudah diupdate ke localStorage
    localStorage.setItem('debts', JSON.stringify(debts));

    // Update tampilan daftar hutang
    displayDebts();
}


// Menambahkan event listener untuk elemen totalReturnAmount agar dapat diklik
document.getElementById('totalReturnAmount').addEventListener('click', function() {
    viewReturnCustomers(); // Memanggil fungsi toggle ketika diklik
});


        function showReturnForm(index) {
    const returnForm = document.getElementById(`returnForm${index}`);
    
    // Cek apakah form sudah tampil atau tidak
    if (returnForm.style.display === 'block') {
        // Jika sudah tampil, sembunyikan form
        returnForm.style.display = 'none';
    } else {
        // Jika belum tampil, tampilkan form
        returnForm.style.display = 'block';
    }
}       
 

// Fungsi untuk mencari data customer
function searchDebts() {
    // Ambil nilai input pencarian
    let searchQuery = document.getElementById('searchInput').value.trim().toLowerCase();
    
    // Ambil semua elemen debt-item
    const debtItems = Array.from(document.getElementsByClassName('debt-item'));

    // Filter debt-item berdasarkan query pencarian
    const filteredDebtItems = debtItems.filter(debtItem => {
        const debtText = debtItem.innerText.toLowerCase();  // Mengambil teks di dalam elemen
        return debtText.includes(searchQuery);  // Cek apakah teks mengandung query pencarian
    });

    // Sembunyikan semua debt-item terlebih dahulu
    debtItems.forEach(debtItem => {
        debtItem.style.display = 'none';
    });

    // Tampilkan hanya debt-item yang sudah difilter
    filteredDebtItems.forEach(debtItem => {
        debtItem.style.display = 'block';
    });

    // Jika ada hasil pencarian, scroll ke elemen pertama yang ditemukan
    if (filteredDebtItems.length > 0) {
        filteredDebtItems[0].scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}
// Fungsi untuk mengedit data pelanggan
function editCustomerData(index) {
    // Cari data pelanggan berdasarkan index yang diklik
    const debt = debts[index];

    // Tampilkan form edit
    const newName = prompt("Edit Nama Pelanggan:", debt.customerName);
    const newPhone = prompt("Edit Nomor HP:", debt.customerPhone);
    const newDebtAmount = prompt("Edit Jumlah Hutang:", debt.amount);

    // Validasi input
    if (newName && newPhone && !isNaN(newDebtAmount) && newDebtAmount >= 0) {
        // Memperbarui data pelanggan
        debt.customerName = newName;
        debt.customerPhone = newPhone;
        debt.amount = parseFloat(newDebtAmount);

        // Simpan perubahan ke localStorage
        localStorage.setItem('debts', JSON.stringify(debts));

        // Menampilkan kembali daftar hutang
        displayDebts();
    } else {
        alert("Input tidak valid. Pastikan semua data diisi dengan benar.");
    }
}


// Fungsi untuk toggle form pembayaran
function togglePaymentForm(index) {
    const paymentForm = document.getElementById(`paymentForm${index}`);
    if (paymentForm.style.display === "none" || paymentForm.style.display === "") {
        paymentForm.style.display = "block";
    } else {
        paymentForm.style.display = "none";
    }
}
// Fungsi untuk konfirmasi pembayaran
function confirmPayment(index) {
    const paymentAmount = parseFloat(document.getElementById(`paymentAmount${index}`).value);
    const debt = debts[index];

    // Mengecek apakah jumlah pembayaran lebih besar dari hutang yang tersisa
    if (paymentAmount > debt.amount) {
        const returnAmount = paymentAmount - debt.amount; // Menghitung kembalian
        debt.returnAmount = returnAmount; // Menyimpan kembalian dalam data hutang

        // Menyimpan riwayat pembayaran yang mencatat jumlah pembayaran yang lebih besar dari hutang
        debt.payments.push({
            date: new Date().toLocaleString(),
            paid: debt.amount,  // Jumlah yang dibayar sesuai dengan hutang
            after: 0  // Setelah pembayaran, hutang menjadi 0
        });

        // Setel jumlah hutang menjadi 0
        debt.amount = 0;

        // Menampilkan pesan kembalian
        alert(`Pembayaran melebihi jumlah hutang. Kembalian Anda adalah: ${returnAmount}`);
    } else if (paymentAmount <= 0) {
        // Jika pembayaran kurang dari atau sama dengan 0, tampilkan peringatan
        alert("Jumlah pembayaran harus lebih besar dari 0.");
        return;
    } else {
        // Jika jumlah pembayaran valid dan lebih kecil atau sama dengan hutang
        debt.amount -= paymentAmount;
        debt.amount = debt.amount < 0 ? 0 : debt.amount; // Pastikan hutang tidak negatif

        // Menyimpan riwayat pembayaran biasa
        debt.payments.push({
            date: new Date().toLocaleString(),
            paid: paymentAmount,  // Jumlah yang dibayar
            after: debt.amount  // Jumlah hutang setelah pembayaran
        });
    }

    // Menyimpan data hutang yang diperbarui ke localStorage
    localStorage.setItem('debts', JSON.stringify(debts));

    // Update tampilan
    displayDebts();

    // Cek apakah ada pencarian yang sedang aktif (input pencarian tidak kosong)
    let searchQuery = document.getElementById('searchInput').value.trim().toLowerCase();
    if (searchQuery) {
        // Jika ada pencarian, pastikan untuk memanggil kembali fungsi pencarian
        searchDebts();
    } else {
        // Jika tidak ada pencarian, scroll halaman ke posisi terakhir dilihat
        const lastSeenElement = document.querySelector('.last-seen');
        if (lastSeenElement) {
            lastSeenElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }
}

function deletePayment(index, paymentIndex) {
    const debt = debts[index];
    
    // Menghapus riwayat pembayaran berdasarkan paymentIndex
    debt.payments.splice(paymentIndex, 1);

    // Menyimpan data hutang yang telah diperbarui
    localStorage.setItem('debts', JSON.stringify(debts));

    // Update tampilan setelah penghapusan pembayaran
    displayDebts();
}


// Fungsi untuk toggle form tambahan hutang
function toggleDebtForm(index) {
    const debtForm = document.getElementById(`debtForm${index}`);
    if (debtForm.style.display === "none" || debtForm.style.display === "") {
        debtForm.style.display = "block"; // Menampilkan form
    } else {
        debtForm.style.display = "none"; // Menyembunyikan form
    }
}

function confirmDebtAddition(index) {
    const additionalDebtAmount = parseFloat(document.getElementById(`additionalDebtAmount${index}`).value);
    const debt = debts[index];

    // Validasi agar jumlah hutang yang dimasukkan valid
    if (isNaN(additionalDebtAmount) || additionalDebtAmount <= 0) {
        alert("Jumlah hutang tambahan harus lebih besar dari 0 dan berupa angka.");
        return;
    }

    // Tambahkan jumlah hutang yang dimasukkan ke data hutang
    debt.amount += additionalDebtAmount;

    // Simpan data hutang yang diperbarui ke localStorage
    localStorage.setItem('debts', JSON.stringify(debts));

    // Tampilkan daftar hutang yang diperbarui
    displayDebts();

    // Kosongkan input setelah penambahan
    document.getElementById(`additionalDebtAmount${index}`).value = '';

    // Sembunyikan form setelah konfirmasi
    toggleDebtForm(index);

    // Cek apakah ada pencarian yang sedang aktif (input pencarian tidak kosong)
    let searchQuery = document.getElementById('searchInput').value.trim().toLowerCase();
    if (searchQuery) {
        // Jika ada pencarian, pastikan untuk memanggil kembali fungsi pencarian
        searchDebts();
    } else {
        // Jika tidak ada pencarian, scroll halaman ke posisi terakhir dilihat
        const lastSeenElement = document.querySelector('.last-seen');
        if (lastSeenElement) {
            lastSeenElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }
}
    
// Fungsi untuk membackup data hutang, pembayaran, dan kembalian
function backupData() {
    const backupText = debts.map(debt => {
        return `${debt.customerName} (${debt.customerPhone}) - Hutang: Rp ${debt.amount.toLocaleString()}\nPembayaran:\n` +
            debt.payments.map(payment => `- Rp ${payment.paid.toLocaleString()} (${payment.date})`).join('\n') +
            (debt.returnAmount !== undefined && debt.returnAmount > 0 ? `Kembalian: Rp ${debt.returnAmount.toLocaleString()}` : '') + // Menambahkan data kembalian jika ada
            '\n'; // Menambahkan baris baru setelah setiap data hutang
    }).join('\n');

    // Tampilkan hasil backup di dalam textarea
    const backupTextarea = document.getElementById('backupTextarea');
    backupTextarea.style.display = 'block'; // Menampilkan textarea
    backupTextarea.textContent = backupText; // Mengisi textarea dengan data backup

    // Salin data backup ke clipboard
    navigator.clipboard.writeText(backupText).then(() => {
        console.log('Data backup berhasil disalin ke clipboard');
    }).catch(err => {
        console.error('Gagal menyalin data ke clipboard: ', err);
    });
}
 
        // Fungsi untuk menghapus semua riwayat pembayaran
function deleteAllPayments() {
    debts.forEach(debt => {
        // Hapus hanya riwayat pembayaran tanpa mengubah jumlah hutang
        debt.payments = [];
    });

    // Simpan perubahan ke localStorage
    localStorage.setItem('debts', JSON.stringify(debts));
    // Tampilkan kembali daftar hutang setelah perubahan
    displayDebts();
}
    
        // Fungsi untuk tagih lewat WhatsApp
        function tagihCustomer(index) {
            const debt = debts[index];
            const message = `Halo *${debts[index].customerName}*,
─────────────────
Kami ingin mengingatkan bahwa kamu masih memiliki hutang sebesar:
Rp *${debts[index].amount.toLocaleString()}*
─────────────────
Kami Tunggu pembayaran dalam waktu dekat,\n
*BISA DIBAYARKAN BESOK, ya?*
Salam hangat,\n
[SAERAH CELL]`;

            const whatsappUrl = `https://wa.me/${debt.customerPhone}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }
    
        // Menambahkan hutang baru ke dalam array debts dan menyimpannya
       // Fungsi untuk mensanitasi input nomor telepon
       function sanitizePhoneInput(event) {
            let phone = event.target.value;

            // Menghapus semua karakter yang bukan angka
            phone = phone.replace(/[^0-9]/g, '');

            // Jika nomor telepon dimulai dengan 0, ganti dengan 62
            if (phone.startsWith('0')) {
                phone = '62' + phone.substring(1);
            }

            // Set kembali nilai input dengan nomor telepon yang sudah disanitasi
            event.target.value = phone;
        }

        // Menambahkan hutang baru ke dalam array debts dan menyimpannya ke localStorage
        document.getElementById('debtForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const debtAmount = parseFloat(document.getElementById('debtAmount').value);

            if (customerName && customerPhone && !isNaN(debtAmount)) {
                const newDebt = {
                    customerName: customerName,
                    customerPhone: customerPhone,
                    amount: debtAmount,
                    originalAmount: debtAmount, // Menyimpan jumlah hutang asli
                    payments: []
                };

                debts.push(newDebt);  // Menambahkan data hutang ke array debts
                localStorage.setItem('debts', JSON.stringify(debts));  // Menyimpan ke localStorage
                displayDebts();  // Menampilkan daftar hutang

                // Reset form setelah menambah hutang
                document.getElementById('debtForm').reset();
            }
        });

        // Menampilkan daftar hutang yang ada pada saat halaman pertama kali dimuat
        displayDebts();
    </script>
    
    </body>
    </html>
